import{a as N,b as v,c as z,d as B,f as G,g as R,h as j,i as V,j as X,k as q,l as W,m as Z,o as $}from"./chunk-K7Q5MZWP.js";import{Aa as p,Ca as a,Da as y,Ea as u,Fa as I,La as O,Ma as A,Xa as F,Ya as P,Z as E,_ as S,_a as w,ab as L,c as C,ha as M,hb as D,ia as o,ka as _,kb as g,la as k,nb as H,pb as U,qa as s,ta as d,ua as x,va as r,wa as n,xa as b,ya as T,za as f}from"./chunk-5P6X64GI.js";function J(t,l){if(t&1&&(r(0,"div",33),a(1),n()),t&2){let i=p();o(),u(" ",i.successMessage," ")}}function Q(t,l){if(t&1&&(r(0,"div",34),a(1),n()),t&2){let i=p();o(),u(" ",i.errorMessage," ")}}function ee(t,l){if(t&1&&(r(0,"div",35),a(1),n()),t&2){let i=p();o(),u(" ",i.title==null||i.title.value==null?null:i.title.value.length,"/50 ")}}function te(t,l){t&1&&(r(0,"span"),a(1,"Le titre est obligatoire"),n())}function ie(t,l){t&1&&(r(0,"span"),a(1," Maximum 50 caract\xE8res "),n())}function ne(t,l){if(t&1&&(r(0,"div",36),s(1,te,2,0,"span",31)(2,ie,2,0,"span",31),n()),t&2){let i=p();o(),d("ngIf",i.title==null||i.title.errors==null?null:i.title.errors.required),o(),d("ngIf",i.title==null||i.title.errors==null?null:i.title.errors.maxlength)}}function re(t,l){t&1&&(r(0,"span"),a(1,"L'artiste est obligatoire"),n())}function oe(t,l){if(t&1&&(r(0,"div",36),s(1,re,2,0,"span",31),n()),t&2){let i=p();o(),d("ngIf",i.artist==null||i.artist.errors==null?null:i.artist.errors.required)}}function ae(t,l){if(t&1&&(r(0,"div",35),a(1),n()),t&2){let i=p();o(),u(" ",i.description==null||i.description.value==null?null:i.description.value.length,"/200 ")}}function le(t,l){t&1&&(r(0,"span"),a(1," Maximum 200 caract\xE8res "),n())}function de(t,l){if(t&1&&(r(0,"div",36),s(1,le,2,0,"span",31),n()),t&2){let i=p();o(),d("ngIf",i.description==null||i.description.errors==null?null:i.description.errors.maxlength)}}function ce(t,l){if(t&1&&(r(0,"option",37),a(1),O(2,"titlecase"),n()),t&2){let i=l.$implicit;d("value",i),o(),u(" ",A(2,2,i)," ")}}function se(t,l){t&1&&(r(0,"span"),a(1,"La cat\xE9gorie est obligatoire"),n())}function pe(t,l){if(t&1&&(r(0,"div",36),s(1,se,2,0,"span",31),n()),t&2){let i=p();o(),d("ngIf",i.category==null||i.category.errors==null?null:i.category.errors.required)}}function me(t,l){if(t&1&&(r(0,"div",38),a(1),n()),t&2){let i=p();o(),u(" \u2705 ",i.fileInfo," ")}}function ue(t,l){if(t&1&&(r(0,"div",36),a(1),n()),t&2){let i=p();o(),u(" ",i.fileError," ")}}function ge(t,l){t&1&&(r(0,"div",36),a(1," Veuillez s\xE9lectionner un fichier audio "),n())}function fe(t,l){if(t&1){let i=T();r(0,"div",39),b(1,"img",40),r(2,"div",41)(3,"span"),a(4),n(),r(5,"button",42),f("click",function(){E(i);let c=p();return S(c.removeCoverImage())}),a(6,"\u2715 Supprimer"),n()()()}if(t&2){let i=p();o(),d("src",i.coverImagePreview,M),o(3),y(i.coverImageInfo)}}function ve(t,l){if(t&1&&(r(0,"div",36),a(1),n()),t&2){let i=p();o(),u(" ",i.coverImageError," ")}}function _e(t,l){t&1&&(r(0,"span"),a(1,"\u2713 Ajouter"),n())}function xe(t,l){t&1&&(r(0,"span"),a(1,"\u23F3 Chargement..."),n())}var Y=class t{constructor(l,i,e,c){this.formBuilder=l;this.trackService=i;this.indexedDbStorage=e;this.router=c}trackForm;submitted=!1;isLoading=!1;successMessage="";errorMessage="";categories=g.CATEGORIES;selectedFile=null;fileError="";fileInfo="";selectedCoverImage=null;coverImageError="";coverImageInfo="";coverImagePreview=null;MAX_FILE_SIZE_MB=g.MAX_AUDIO_FILE_SIZE/(1024*1024);ALLOWED_FORMATS=g.ALLOWED_AUDIO_EXTENSIONS.join(", ");MAX_IMAGE_SIZE_MB=g.MAX_IMAGE_FILE_SIZE/(1024*1024);ALLOWED_IMAGE_FORMATS=g.ALLOWED_IMAGE_EXTENSIONS.join(", ");ngOnInit(){this.createForm()}createForm(){this.trackForm=this.formBuilder.group({title:["",[v.required,v.maxLength(g.TITLE_MAX_LENGTH)]],artist:["",[v.required]],description:["",[v.maxLength(g.DESCRIPTION_MAX_LENGTH)]],category:["",[v.required]]})}get title(){return this.trackForm.get("title")}get artist(){return this.trackForm.get("artist")}get description(){return this.trackForm.get("description")}get category(){return this.trackForm.get("category")}onFileSelected(l){let i=l.target,e=i.files;if(this.selectedFile=null,this.fileError="",this.fileInfo="",!e||e.length===0)return;let c=e[0],m=this.indexedDbStorage.validateAudioFile(c);if(!m.isValid){this.fileError=m.error||"Fichier invalide",i.value="";return}this.selectedFile=c,this.fileInfo=`${c.name} (${this.indexedDbStorage.formatFileSize(c.size)})`}onCoverImageSelected(l){let i=l.target,e=i.files;if(this.selectedCoverImage=null,this.coverImageError="",this.coverImageInfo="",this.coverImagePreview=null,!e||e.length===0)return;let c=e[0],m=this.indexedDbStorage.validateImageFile(c);if(!m.isValid){this.coverImageError=m.error||"Image invalide",i.value="";return}this.selectedCoverImage=c,this.coverImageInfo=`${c.name} (${this.indexedDbStorage.formatFileSize(c.size)})`;let h=new FileReader;h.onload=K=>{this.coverImagePreview=K.target?.result},h.readAsDataURL(c)}removeCoverImage(){this.selectedCoverImage=null,this.coverImageError="",this.coverImageInfo="",this.coverImagePreview=null}onSubmit(){return C(this,null,function*(){if(this.submitted=!0,this.errorMessage="",this.successMessage="",!this.trackForm.invalid){if(!this.selectedFile){this.fileError="Veuillez s\xE9lectionner un fichier audio";return}this.isLoading=!0;try{let l={id:this.trackService.generateId(),title:this.title?.value,artist:this.artist?.value,description:this.description?.value||"",category:this.category?.value,duration:0,addedDate:new Date,fileSize:this.selectedFile.size,plays:0,liked:!1};yield this.trackService.addTrack(l,this.selectedFile,this.selectedCoverImage||void 0),this.successMessage="\u2705 Track ajout\xE9 avec succ\xE8s!",this.resetForm(),setTimeout(()=>{this.router.navigate(["/library"])},2e3)}catch(l){this.errorMessage=l.message||"Erreur lors de l'ajout du track"}finally{this.isLoading=!1}}})}resetForm(){this.trackForm.reset(),this.selectedFile=null,this.fileInfo="",this.fileError="",this.selectedCoverImage=null,this.coverImageInfo="",this.coverImageError="",this.coverImagePreview=null,this.submitted=!1,this.errorMessage=""}goBack(){this.router.navigate(["/library"])}static \u0275fac=function(i){return new(i||t)(_(Z),_(U),_(H),_(D))};static \u0275cmp=k({type:t,selectors:[["app-add-track"]],decls:71,vars:31,consts:[[1,"add-track-container"],[1,"header"],[1,"btn-back",3,"click"],["class","alert alert-success",4,"ngIf"],["class","alert alert-error",4,"ngIf"],[1,"form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","title"],["id","title","type","text","formControlName","title","placeholder","Nom du track","maxlength","50",1,"form-input"],["class","char-count",4,"ngIf"],["class","error-message",4,"ngIf"],["for","artist"],["id","artist","type","text","formControlName","artist","placeholder","Nom de l'artiste",1,"form-input"],["for","description"],["id","description","formControlName","description","placeholder","Courte description du track...","rows","3","maxlength","200",1,"form-input"],["for","category"],["id","category","formControlName","category",1,"form-input"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","audioFile"],[1,"file-info"],[1,"file-input-wrapper"],["id","audioFile","type","file","accept",".mp3,.wav,.ogg,audio/mpeg,audio/wav,audio/ogg",1,"file-input",3,"change"],["for","audioFile",1,"file-input-label"],["class","file-selected",4,"ngIf"],["for","coverImage"],["id","coverImage","type","file","accept",".png,.jpeg,.jpg,image/png,image/jpeg",1,"file-input",3,"change"],["for","coverImage",1,"file-input-label"],["class","cover-preview",4,"ngIf"],[1,"form-actions"],["type","submit",1,"btn","btn-primary",3,"disabled"],[4,"ngIf"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],[1,"alert","alert-success"],[1,"alert","alert-error"],[1,"char-count"],[1,"error-message"],[3,"value"],[1,"file-selected"],[1,"cover-preview"],["alt","Aper\xE7u de la couverture",1,"cover-preview-img",3,"src"],[1,"cover-preview-info"],["type","button",1,"btn-remove-cover",3,"click"]],template:function(i,e){i&1&&(r(0,"div",0)(1,"div",1)(2,"button",2),f("click",function(){return e.goBack()}),a(3,"\u2190 Retour"),n(),r(4,"h2"),a(5,"\u2795 Ajouter un nouveau track"),n()(),s(6,J,2,1,"div",3)(7,Q,2,1,"div",4),r(8,"form",5),f("ngSubmit",function(){return e.onSubmit()}),r(9,"div",6)(10,"label",7),a(11,"Titre * "),r(12,"small"),a(13,"(max 50 caract\xE8res)"),n()(),b(14,"input",8),s(15,ee,2,1,"div",9)(16,ne,3,2,"div",10),n(),r(17,"div",6)(18,"label",11),a(19,"Artiste *"),n(),b(20,"input",12),s(21,oe,2,1,"div",10),n(),r(22,"div",6)(23,"label",13),a(24,"Description "),r(25,"small"),a(26,"(optionnel, max 200 caract\xE8res)"),n()(),b(27,"textarea",14),s(28,ae,2,1,"div",9)(29,de,2,1,"div",10),n(),r(30,"div",6)(31,"label",15),a(32,"Cat\xE9gorie *"),n(),r(33,"select",16)(34,"option",17),a(35,"-- S\xE9lectionner --"),n(),s(36,ce,3,4,"option",18),n(),s(37,pe,2,1,"div",10),n(),r(38,"div",6)(39,"label",19),a(40,"Fichier audio *"),n(),r(41,"div",20)(42,"small"),a(43),n()(),r(44,"div",21)(45,"input",22),f("change",function(m){return e.onFileSelected(m)}),n(),r(46,"label",23),a(47," \u{1F4C1} Choisir un fichier audio "),n()(),s(48,me,2,1,"div",24)(49,ue,2,1,"div",10)(50,ge,2,0,"div",10),n(),r(51,"div",6)(52,"label",25),a(53,"Image de couverture "),r(54,"small"),a(55,"(optionnel)"),n()(),r(56,"div",20)(57,"small"),a(58),n()(),r(59,"div",21)(60,"input",26),f("change",function(m){return e.onCoverImageSelected(m)}),n(),r(61,"label",27),a(62," \u{1F5BC}\uFE0F Choisir une image de couverture "),n()(),s(63,fe,7,2,"div",28)(64,ve,2,1,"div",10),n(),r(65,"div",29)(66,"button",30),s(67,_e,2,0,"span",31)(68,xe,2,0,"span",31),n(),r(69,"button",32),f("click",function(){return e.resetForm()}),a(70," R\xE9initialiser "),n()()()()),i&2&&(o(6),d("ngIf",e.successMessage),o(),d("ngIf",e.errorMessage),o(),d("formGroup",e.trackForm),o(6),x("error",e.submitted&&(e.title==null?null:e.title.invalid)),o(),d("ngIf",e.title==null?null:e.title.value),o(),d("ngIf",e.submitted&&(e.title==null?null:e.title.invalid)),o(4),x("error",e.submitted&&(e.artist==null?null:e.artist.invalid)),o(),d("ngIf",e.submitted&&(e.artist==null?null:e.artist.invalid)),o(6),x("error",e.submitted&&(e.description==null?null:e.description.invalid)),o(),d("ngIf",e.description==null?null:e.description.value),o(),d("ngIf",e.submitted&&(e.description==null?null:e.description.invalid)),o(4),x("error",e.submitted&&(e.category==null?null:e.category.invalid)),o(3),d("ngForOf",e.categories),o(),d("ngIf",e.submitted&&(e.category==null?null:e.category.invalid)),o(6),I("Formats accept\xE9s: ",e.ALLOWED_FORMATS," | Taille max: ",e.MAX_FILE_SIZE_MB," MB"),o(5),d("ngIf",e.fileInfo),o(),d("ngIf",e.fileError),o(),d("ngIf",e.submitted&&!e.selectedFile&&!e.fileError),o(8),I("Formats accept\xE9s: ",e.ALLOWED_IMAGE_FORMATS," | Taille max: ",e.MAX_IMAGE_SIZE_MB," MB"),o(5),d("ngIf",e.coverImagePreview),o(),d("ngIf",e.coverImageError),o(2),d("disabled",e.isLoading),o(),d("ngIf",!e.isLoading),o(),d("ngIf",e.isLoading),o(),d("disabled",e.isLoading))},dependencies:[L,F,P,w,$,G,X,q,N,V,z,B,W,R,j],styles:[".add-track-container[_ngcontent-%COMP%]{max-width:600px;margin:30px auto;padding:30px;border-radius:16px;background-color:#fff;box-shadow:0 4px 20px #0000001a}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px;margin-bottom:30px}.btn-back[_ngcontent-%COMP%]{background:none;border:none;font-size:16px;cursor:pointer;color:#666;transition:color .3s ease}.btn-back[_ngcontent-%COMP%]:hover{color:#333}.header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#333;font-size:24px}.alert[_ngcontent-%COMP%]{padding:15px 20px;border-radius:10px;margin-bottom:20px;font-weight:500}.alert-success[_ngcontent-%COMP%]{background-color:#d4edda;border:1px solid #c3e6cb;color:#155724}.alert-error[_ngcontent-%COMP%]{background-color:#fee2e2;color:#dc2626;border:1px solid #fecaca}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;position:relative}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;font-size:14px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-weight:400;color:#999}.form-input[_ngcontent-%COMP%]{padding:12px 16px;border:2px solid #e0e0e0;border-radius:10px;font-size:16px;transition:all .3s ease;font-family:inherit;background-color:#fafafa}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea;background-color:#fff;box-shadow:0 0 0 3px #667eea33}.form-input.error[_ngcontent-%COMP%]{border-color:#dc3545;background-color:#fff5f5}.char-count[_ngcontent-%COMP%]{position:absolute;right:10px;top:42px;font-size:12px;color:#999}.error-message[_ngcontent-%COMP%]{color:#dc3545;font-size:13px;padding:5px 0}.file-info[_ngcontent-%COMP%]{color:#666;margin-bottom:10px}.file-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:12px}.file-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:15px}.file-input[_ngcontent-%COMP%]{display:none}.file-input-label[_ngcontent-%COMP%]{padding:14px 24px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:10px;cursor:pointer;font-weight:600;font-size:14px;transition:all .3s ease;white-space:nowrap;border:none}.file-input-label[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.file-selected[_ngcontent-%COMP%]{padding:10px 15px;background-color:#d4edda;border-radius:8px;color:#155724;font-size:14px;margin-top:10px}.cover-preview[_ngcontent-%COMP%]{margin-top:15px;padding:15px;background-color:#f8f9fa;border-radius:12px;border:2px dashed #dee2e6;display:flex;align-items:center;gap:20px}.cover-preview-img[_ngcontent-%COMP%]{width:100px;height:100px;object-fit:cover;border-radius:8px;box-shadow:0 2px 8px #00000026}.cover-preview-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;flex:1}.cover-preview-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#555;font-size:14px}.btn-remove-cover[_ngcontent-%COMP%]{padding:8px 16px;background-color:#dc3545;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:13px;transition:background-color .3s ease;align-self:flex-start}.btn-remove-cover[_ngcontent-%COMP%]:hover{background-color:#c82333}.form-actions[_ngcontent-%COMP%]{display:flex;gap:15px;margin-top:10px}.btn[_ngcontent-%COMP%]{padding:14px 24px;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;flex:1}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none!important}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.btn-secondary[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#333;border:1px solid #e0e0e0}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#e0e0e0}@media (max-width: 600px){.add-track-container[_ngcontent-%COMP%]{margin:15px;padding:20px}.form-actions[_ngcontent-%COMP%]{flex-direction:column}.header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}}"]})};export{Y as AddTrackComponent};
