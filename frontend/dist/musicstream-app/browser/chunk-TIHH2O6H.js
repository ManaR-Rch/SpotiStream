import{a as N,b as h,c as V,d as B,f as R,g as G,h as j,i as X,j as q,k as U,l as W,m as Z,o as $}from"./chunk-K7Q5MZWP.js";import{Aa as s,Ca as a,Da as y,Ea as m,Fa as b,La as O,Ma as P,Xa as F,Ya as w,Z as v,_,_a as A,ab as D,c as S,fb as L,ha as T,hb as z,ia as o,ka as x,kb as g,la as M,nb as H,pb as Y,qa as p,ta as l,ua as C,va as n,wa as r,xa as I,ya as E,za as f}from"./chunk-5P6X64GI.js";function Q(t,i){t&1&&(n(0,"div",7),I(1,"div",8),n(2,"p"),a(3,"Chargement du track..."),r()())}function ee(t,i){if(t&1&&(n(0,"div",9),a(1),r()),t&2){let e=s();o(),m(" ",e.successMessage," ")}}function te(t,i){if(t&1&&(n(0,"div",10),a(1),r()),t&2){let e=s();o(),m(" ",e.errorMessage," ")}}function ie(t,i){if(t&1&&(n(0,"div",40),a(1),r()),t&2){let e=s(2);o(),m(" ",e.title==null||e.title.value==null?null:e.title.value.length,"/50 ")}}function ne(t,i){t&1&&(n(0,"span"),a(1,"Le titre est obligatoire"),r())}function re(t,i){t&1&&(n(0,"span"),a(1,"Maximum 50 caract\xE8res"),r())}function oe(t,i){if(t&1&&(n(0,"div",41),p(1,ne,2,0,"span",38)(2,re,2,0,"span",38),r()),t&2){let e=s(2);o(),l("ngIf",e.title==null||e.title.errors==null?null:e.title.errors.required),o(),l("ngIf",e.title==null||e.title.errors==null?null:e.title.errors.maxlength)}}function ae(t,i){t&1&&(n(0,"span"),a(1,"L'artiste est obligatoire"),r())}function le(t,i){if(t&1&&(n(0,"div",41),p(1,ae,2,0,"span",38),r()),t&2){let e=s(2);o(),l("ngIf",e.artist==null||e.artist.errors==null?null:e.artist.errors.required)}}function ce(t,i){if(t&1&&(n(0,"div",40),a(1),r()),t&2){let e=s(2);o(),m(" ",e.description==null||e.description.value==null?null:e.description.value.length,"/200 ")}}function se(t,i){t&1&&(n(0,"span"),a(1,"Maximum 200 caract\xE8res"),r())}function de(t,i){if(t&1&&(n(0,"div",41),p(1,se,2,0,"span",38),r()),t&2){let e=s(2);o(),l("ngIf",e.description==null||e.description.errors==null?null:e.description.errors.maxlength)}}function pe(t,i){if(t&1&&(n(0,"option",42),a(1),O(2,"titlecase"),r()),t&2){let e=i.$implicit;l("value",e),o(),m(" ",P(2,2,e)," ")}}function me(t,i){t&1&&(n(0,"span"),a(1,"La cat\xE9gorie est obligatoire"),r())}function ue(t,i){if(t&1&&(n(0,"div",41),p(1,me,2,0,"span",38),r()),t&2){let e=s(2);o(),l("ngIf",e.category==null||e.category.errors==null?null:e.category.errors.required)}}function ge(t,i){if(t&1&&(n(0,"div",43),a(1),r()),t&2){let e=s(2);o(),m(" \u{1F4C1} ",e.currentAudioInfo," ")}}function fe(t,i){if(t&1&&(n(0,"div",44),a(1),r()),t&2){let e=s(2);o(),m(" \u2705 ",e.fileInfo," ")}}function ve(t,i){if(t&1&&(n(0,"div",41),a(1),r()),t&2){let e=s(2);o(),m(" ",e.fileError," ")}}function _e(t,i){t&1&&(n(0,"span"),a(1,"Image actuelle"),r())}function xe(t,i){if(t&1&&(n(0,"span"),a(1),r()),t&2){let e=s(3);o(),y(e.coverImageInfo)}}function Ie(t,i){if(t&1){let e=E();n(0,"div",45),I(1,"img",46),n(2,"div",47),p(3,_e,2,0,"span",38)(4,xe,2,1,"span",38),n(5,"button",48),f("click",function(){v(e);let c=s(2);return _(c.removeCoverImage())}),a(6,"\u2715 Supprimer"),r()()()}if(t&2){let e=s(2);o(),l("src",e.coverImagePreview,T),o(2),l("ngIf",e.hasExistingCover),o(),l("ngIf",e.coverImageInfo)}}function he(t,i){if(t&1&&(n(0,"div",41),a(1),r()),t&2){let e=s(2);o(),m(" ",e.coverImageError," ")}}function Ce(t,i){t&1&&(n(0,"span"),a(1,"\u{1F4BE} Enregistrer"),r())}function Ee(t,i){t&1&&(n(0,"span"),a(1,"\u23F3 Enregistrement..."),r())}function be(t,i){if(t&1){let e=E();n(0,"form",11),f("ngSubmit",function(){v(e);let c=s();return _(c.onSubmit())}),n(1,"div",12)(2,"label",13),a(3,"Titre * "),n(4,"small"),a(5,"(max 50 caract\xE8res)"),r()(),I(6,"input",14),p(7,ie,2,1,"div",15)(8,oe,3,2,"div",16),r(),n(9,"div",12)(10,"label",17),a(11,"Artiste *"),r(),I(12,"input",18),p(13,le,2,1,"div",16),r(),n(14,"div",12)(15,"label",19),a(16,"Description "),n(17,"small"),a(18,"(optionnel, max 200 caract\xE8res)"),r()(),I(19,"textarea",20),p(20,ce,2,1,"div",15)(21,de,2,1,"div",16),r(),n(22,"div",12)(23,"label",21),a(24,"Cat\xE9gorie *"),r(),n(25,"select",22)(26,"option",23),a(27,"-- S\xE9lectionner --"),r(),p(28,pe,3,4,"option",24),r(),p(29,ue,2,1,"div",16),r(),n(30,"div",12)(31,"label",25),a(32,"Fichier audio "),n(33,"small"),a(34,"(optionnel - laisser vide pour conserver l'actuel)"),r()(),n(35,"div",26)(36,"small"),a(37),r()(),p(38,ge,2,1,"div",27),n(39,"div",28)(40,"input",29),f("change",function(c){v(e);let u=s();return _(u.onFileSelected(c))}),r(),n(41,"label",30),a(42," \u{1F4C1} Changer le fichier audio "),r()(),p(43,fe,2,1,"div",31)(44,ve,2,1,"div",16),r(),n(45,"div",12)(46,"label",32),a(47,"Image de couverture "),n(48,"small"),a(49,"(optionnel)"),r()(),n(50,"div",26)(51,"small"),a(52),r()(),n(53,"div",28)(54,"input",33),f("change",function(c){v(e);let u=s();return _(u.onCoverImageSelected(c))}),r(),n(55,"label",34),a(56),r()(),p(57,Ie,7,3,"div",35)(58,he,2,1,"div",16),r(),n(59,"div",36)(60,"button",37),p(61,Ce,2,0,"span",38)(62,Ee,2,0,"span",38),r(),n(63,"button",39),f("click",function(){v(e);let c=s();return _(c.goBack())}),a(64," Annuler "),r()()()}if(t&2){let e=s();l("formGroup",e.trackForm),o(6),C("error",e.submitted&&(e.title==null?null:e.title.invalid)),o(),l("ngIf",e.title==null?null:e.title.value),o(),l("ngIf",e.submitted&&(e.title==null?null:e.title.invalid)),o(4),C("error",e.submitted&&(e.artist==null?null:e.artist.invalid)),o(),l("ngIf",e.submitted&&(e.artist==null?null:e.artist.invalid)),o(6),C("error",e.submitted&&(e.description==null?null:e.description.invalid)),o(),l("ngIf",e.description==null?null:e.description.value),o(),l("ngIf",e.submitted&&(e.description==null?null:e.description.invalid)),o(4),C("error",e.submitted&&(e.category==null?null:e.category.invalid)),o(3),l("ngForOf",e.categories),o(),l("ngIf",e.submitted&&(e.category==null?null:e.category.invalid)),o(8),b("Formats accept\xE9s: ",e.ALLOWED_FORMATS," | Taille max: ",e.MAX_FILE_SIZE_MB," MB"),o(),l("ngIf",e.currentAudioInfo&&!e.fileInfo),o(5),l("ngIf",e.fileInfo),o(),l("ngIf",e.fileError),o(8),b("Formats accept\xE9s: ",e.ALLOWED_IMAGE_FORMATS," | Taille max: ",e.MAX_IMAGE_SIZE_MB," MB"),o(4),m(" \u{1F5BC}\uFE0F ",e.coverImagePreview?"Changer l'image":"Ajouter une image"," "),o(),l("ngIf",e.coverImagePreview),o(),l("ngIf",e.coverImageError),o(2),l("disabled",e.isLoading),o(),l("ngIf",!e.isLoading),o(),l("ngIf",e.isLoading),o(),l("disabled",e.isLoading)}}var K=class t{constructor(i,e,d,c,u){this.formBuilder=i;this.trackService=e;this.indexedDbStorage=d;this.route=c;this.router=u}trackForm;submitted=!1;isLoading=!1;isLoadingTrack=!0;successMessage="";errorMessage="";categories=g.CATEGORIES;trackId=null;currentTrack=null;selectedFile=null;fileError="";fileInfo="";currentAudioInfo="";selectedCoverImage=null;coverImageError="";coverImageInfo="";coverImagePreview=null;hasExistingCover=!1;MAX_FILE_SIZE_MB=g.MAX_AUDIO_FILE_SIZE/(1024*1024);ALLOWED_FORMATS=g.ALLOWED_AUDIO_EXTENSIONS.join(", ");MAX_IMAGE_SIZE_MB=g.MAX_IMAGE_FILE_SIZE/(1024*1024);ALLOWED_IMAGE_FORMATS=g.ALLOWED_IMAGE_EXTENSIONS.join(", ");ngOnInit(){this.createForm(),this.loadTrack()}createForm(){this.trackForm=this.formBuilder.group({title:["",[h.required,h.maxLength(g.TITLE_MAX_LENGTH)]],artist:["",[h.required]],description:["",[h.maxLength(g.DESCRIPTION_MAX_LENGTH)]],category:["",[h.required]]})}loadTrack(){if(this.trackId=this.route.snapshot.paramMap.get("id"),!this.trackId){this.errorMessage="ID de track manquant",this.isLoadingTrack=!1;return}this.trackService.getTrackById(this.trackId).subscribe({next:i=>{i?(this.currentTrack=i,this.populateForm(i),i.fileSize&&(this.currentAudioInfo=`Fichier actuel: ${this.indexedDbStorage.formatFileSize(i.fileSize)}`),i.coverImage&&(this.coverImagePreview=i.coverImage,this.hasExistingCover=!0)):this.errorMessage="Track non trouv\xE9",this.isLoadingTrack=!1},error:i=>{console.error("Error loading track:",i),this.errorMessage="Erreur lors du chargement du track",this.isLoadingTrack=!1}})}populateForm(i){this.trackForm.patchValue({title:i.title,artist:i.artist,description:i.description||"",category:i.category})}get title(){return this.trackForm.get("title")}get artist(){return this.trackForm.get("artist")}get description(){return this.trackForm.get("description")}get category(){return this.trackForm.get("category")}onFileSelected(i){let e=i.target,d=e.files;if(this.selectedFile=null,this.fileError="",this.fileInfo="",!d||d.length===0)return;let c=d[0],u=this.indexedDbStorage.validateAudioFile(c);if(!u.isValid){this.fileError=u.error||"Fichier invalide",e.value="";return}this.selectedFile=c,this.fileInfo=`Nouveau fichier: ${c.name} (${this.indexedDbStorage.formatFileSize(c.size)})`}onCoverImageSelected(i){let e=i.target,d=e.files;if(this.selectedCoverImage=null,this.coverImageError="",this.coverImageInfo="",!d||d.length===0)return;let c=d[0],u=this.indexedDbStorage.validateImageFile(c);if(!u.isValid){this.coverImageError=u.error||"Image invalide",e.value="";return}this.selectedCoverImage=c,this.coverImageInfo=`${c.name} (${this.indexedDbStorage.formatFileSize(c.size)})`;let k=new FileReader;k.onload=J=>{this.coverImagePreview=J.target?.result},k.readAsDataURL(c),this.hasExistingCover=!1}removeCoverImage(){this.selectedCoverImage=null,this.coverImageError="",this.coverImageInfo="",this.coverImagePreview=null,this.hasExistingCover=!1}onSubmit(){return S(this,null,function*(){if(this.submitted=!0,this.errorMessage="",this.successMessage="",!(this.trackForm.invalid||!this.currentTrack)){this.isLoading=!0;try{let i={title:this.title?.value,artist:this.artist?.value,description:this.description?.value||"",category:this.category?.value};if(this.selectedFile&&this.trackId){let e=yield this.indexedDbStorage.storeAudioFile(this.trackId,this.selectedFile);i.filePath=e,i.fileSize=this.selectedFile.size}if(this.selectedCoverImage&&this.trackId){let e=yield this.indexedDbStorage.storeCoverImage(this.trackId,this.selectedCoverImage);i.coverImage=e,i.coverImageSize=this.selectedCoverImage.size}else!this.coverImagePreview&&this.hasExistingCover&&(i.coverImage=void 0,i.coverImageSize=void 0,this.trackId&&(yield this.indexedDbStorage.deleteCoverImage(this.trackId)));this.trackService.updateTrack(this.trackId,i),this.successMessage="\u2705 Track mis \xE0 jour avec succ\xE8s!",setTimeout(()=>{this.router.navigate(["/library"])},2e3)}catch(i){this.errorMessage=i.message||"Erreur lors de la mise \xE0 jour du track"}finally{this.isLoading=!1}}})}goBack(){this.router.navigate(["/library"])}static \u0275fac=function(e){return new(e||t)(x(Z),x(Y),x(H),x(L),x(z))};static \u0275cmp=M({type:t,selectors:[["app-edit-track"]],decls:10,vars:4,consts:[[1,"edit-track-container"],[1,"header"],[1,"btn-back",3,"click"],["class","loading-container",4,"ngIf"],["class","alert alert-success",4,"ngIf"],["class","alert alert-error",4,"ngIf"],["class","form",3,"formGroup","ngSubmit",4,"ngIf"],[1,"loading-container"],[1,"spinner"],[1,"alert","alert-success"],[1,"alert","alert-error"],[1,"form",3,"ngSubmit","formGroup"],[1,"form-group"],["for","title"],["id","title","type","text","formControlName","title","placeholder","Nom du track","maxlength","50",1,"form-input"],["class","char-count",4,"ngIf"],["class","error-message",4,"ngIf"],["for","artist"],["id","artist","type","text","formControlName","artist","placeholder","Nom de l'artiste",1,"form-input"],["for","description"],["id","description","formControlName","description","placeholder","Courte description du track...","rows","3","maxlength","200",1,"form-input"],["for","category"],["id","category","formControlName","category",1,"form-input"],["value",""],[3,"value",4,"ngFor","ngForOf"],["for","audioFile"],[1,"file-info"],["class","current-file-info",4,"ngIf"],[1,"file-input-wrapper"],["id","audioFile","type","file","accept",".mp3,.wav,.ogg,audio/mpeg,audio/wav,audio/ogg",1,"file-input",3,"change"],["for","audioFile",1,"file-input-label"],["class","file-selected",4,"ngIf"],["for","coverImage"],["id","coverImage","type","file","accept",".png,.jpeg,.jpg,image/png,image/jpeg",1,"file-input",3,"change"],["for","coverImage",1,"file-input-label"],["class","cover-preview",4,"ngIf"],[1,"form-actions"],["type","submit",1,"btn","btn-primary",3,"disabled"],[4,"ngIf"],["type","button",1,"btn","btn-secondary",3,"click","disabled"],[1,"char-count"],[1,"error-message"],[3,"value"],[1,"current-file-info"],[1,"file-selected"],[1,"cover-preview"],["alt","Aper\xE7u de la couverture",1,"cover-preview-img",3,"src"],[1,"cover-preview-info"],["type","button",1,"btn-remove-cover",3,"click"]],template:function(e,d){e&1&&(n(0,"div",0)(1,"div",1)(2,"button",2),f("click",function(){return d.goBack()}),a(3,"\u2190 Retour"),r(),n(4,"h2"),a(5,"\u270F\uFE0F Modifier le track"),r()(),p(6,Q,4,0,"div",3)(7,ee,2,1,"div",4)(8,te,2,1,"div",5)(9,be,65,30,"form",6),r()),e&2&&(o(6),l("ngIf",d.isLoadingTrack),o(),l("ngIf",d.successMessage),o(),l("ngIf",d.errorMessage),o(),l("ngIf",!d.isLoadingTrack&&d.currentTrack))},dependencies:[D,F,w,A,$,R,q,U,N,X,V,B,W,G,j],styles:[".edit-track-container[_ngcontent-%COMP%]{max-width:600px;margin:30px auto;padding:30px;border-radius:16px;background-color:#fff;box-shadow:0 4px 20px #0000001a}.header[_ngcontent-%COMP%]{display:flex;align-items:center;gap:15px;margin-bottom:30px}.btn-back[_ngcontent-%COMP%]{background:none;border:none;font-size:16px;cursor:pointer;color:#666;transition:color .3s ease}.btn-back[_ngcontent-%COMP%]:hover{color:#333}.header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0;color:#333;font-size:24px}.loading-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:15px;padding:40px 0}.spinner[_ngcontent-%COMP%]{width:40px;height:40px;border:4px solid #f3f3f3;border-top:4px solid #667eea;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.alert[_ngcontent-%COMP%]{padding:15px 20px;border-radius:10px;margin-bottom:20px;font-weight:500}.alert-success[_ngcontent-%COMP%]{background-color:#d4edda;border:1px solid #c3e6cb;color:#155724}.alert-error[_ngcontent-%COMP%]{background-color:#fee2e2;color:#dc2626;border:1px solid #fecaca}.form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:24px}.form-group[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:8px;position:relative}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-weight:600;color:#333;font-size:14px}.form-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-weight:400;color:#999}.form-input[_ngcontent-%COMP%]{padding:12px 16px;border:2px solid #e0e0e0;border-radius:10px;font-size:16px;transition:all .3s ease;font-family:inherit;background-color:#fafafa}.form-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#667eea;background-color:#fff;box-shadow:0 0 0 3px #667eea33}.form-input.error[_ngcontent-%COMP%]{border-color:#dc3545;background-color:#fff5f5}.char-count[_ngcontent-%COMP%]{position:absolute;right:10px;top:42px;font-size:12px;color:#999}.error-message[_ngcontent-%COMP%]{color:#dc3545;font-size:13px;padding:5px 0}.file-info[_ngcontent-%COMP%]{color:#666;margin-bottom:10px}.file-info[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{font-size:12px}.current-file-info[_ngcontent-%COMP%]{padding:10px 15px;background-color:#e8f4f8;border-radius:8px;color:#0c5460;font-size:14px;margin-bottom:10px}.file-input-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center;gap:15px}.file-input[_ngcontent-%COMP%]{display:none}.file-input-label[_ngcontent-%COMP%]{padding:14px 24px;background:linear-gradient(135deg,#667eea,#764ba2);color:#fff;border-radius:10px;cursor:pointer;font-weight:600;font-size:14px;transition:all .3s ease;white-space:nowrap;border:none}.file-input-label[_ngcontent-%COMP%]:hover{transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.file-selected[_ngcontent-%COMP%]{padding:10px 15px;background-color:#d4edda;border-radius:8px;color:#155724;font-size:14px;margin-top:10px}.cover-preview[_ngcontent-%COMP%]{margin-top:15px;padding:15px;background-color:#f8f9fa;border-radius:12px;border:2px dashed #dee2e6;display:flex;align-items:center;gap:20px}.cover-preview-img[_ngcontent-%COMP%]{width:100px;height:100px;object-fit:cover;border-radius:8px;box-shadow:0 2px 8px #00000026}.cover-preview-info[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:10px;flex:1}.cover-preview-info[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#555;font-size:14px}.btn-remove-cover[_ngcontent-%COMP%]{padding:8px 16px;background-color:#dc3545;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:13px;transition:background-color .3s ease;align-self:flex-start}.btn-remove-cover[_ngcontent-%COMP%]:hover{background-color:#c82333}.form-actions[_ngcontent-%COMP%]{display:flex;gap:15px;margin-top:10px}.btn[_ngcontent-%COMP%]{padding:14px 24px;border:none;border-radius:10px;font-size:16px;font-weight:600;cursor:pointer;transition:all .3s ease;flex:1}.btn[_ngcontent-%COMP%]:disabled{opacity:.6;cursor:not-allowed;transform:none!important}.btn-primary[_ngcontent-%COMP%]{background:linear-gradient(135deg,#667eea,#764ba2);color:#fff}.btn-primary[_ngcontent-%COMP%]:hover:not(:disabled){transform:translateY(-2px);box-shadow:0 4px 12px #667eea66}.btn-secondary[_ngcontent-%COMP%]{background-color:#f5f5f5;color:#333;border:1px solid #e0e0e0}.btn-secondary[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#e0e0e0}@media (max-width: 600px){.edit-track-container[_ngcontent-%COMP%]{margin:15px;padding:20px}.form-actions[_ngcontent-%COMP%]{flex-direction:column}.header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start}.cover-preview[_ngcontent-%COMP%]{flex-direction:column;text-align:center}}"]})};export{K as EditTrackComponent};
