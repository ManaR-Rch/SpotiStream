<div class="edit-track-container">
  <div class="header">
    <button (click)="goBack()" class="btn-back">‚Üê Retour</button>
    <h2>‚úèÔ∏è Modifier le track</h2>
  </div>

  <!-- Indicateur de chargement initial -->
  <div *ngIf="isLoadingTrack" class="loading-container">
    <div class="spinner"></div>
    <p>Chargement du track...</p>
  </div>

  <!-- Message de succ√®s -->
  <div *ngIf="successMessage" class="alert alert-success">
    {{ successMessage }}
  </div>

  <!-- Message d'erreur -->
  <div *ngIf="errorMessage" class="alert alert-error">
    {{ errorMessage }}
  </div>

  <!-- Formulaire d'√©dition -->
  <form *ngIf="!isLoadingTrack && currentTrack" [formGroup]="trackForm" (ngSubmit)="onSubmit()" class="form">
    
    <!-- Champ: Titre -->
    <div class="form-group">
      <label for="title">Titre * <small>(max 50 caract√®res)</small></label>
      <input
        id="title"
        type="text"
        formControlName="title"
        placeholder="Nom du track"
        class="form-input"
        [class.error]="submitted && title?.invalid"
        maxlength="50"
      />
      <div class="char-count" *ngIf="title?.value">
        {{ title?.value?.length }}/50
      </div>
      <div *ngIf="submitted && title?.invalid" class="error-message">
        <span *ngIf="title?.errors?.['required']">Le titre est obligatoire</span>
        <span *ngIf="title?.errors?.['maxlength']">Maximum 50 caract√®res</span>
      </div>
    </div>

    <!-- Champ: Artiste -->
    <div class="form-group">
      <label for="artist">Artiste *</label>
      <input
        id="artist"
        type="text"
        formControlName="artist"
        placeholder="Nom de l'artiste"
        class="form-input"
        [class.error]="submitted && artist?.invalid"
      />
      <div *ngIf="submitted && artist?.invalid" class="error-message">
        <span *ngIf="artist?.errors?.['required']">L'artiste est obligatoire</span>
      </div>
    </div>

    <!-- Champ: Description -->
    <div class="form-group">
      <label for="description">Description <small>(optionnel, max 200 caract√®res)</small></label>
      <textarea
        id="description"
        formControlName="description"
        placeholder="Courte description du track..."
        class="form-input"
        rows="3"
        [class.error]="submitted && description?.invalid"
        maxlength="200"
      ></textarea>
      <div class="char-count" *ngIf="description?.value">
        {{ description?.value?.length }}/200
      </div>
      <div *ngIf="submitted && description?.invalid" class="error-message">
        <span *ngIf="description?.errors?.['maxlength']">Maximum 200 caract√®res</span>
      </div>
    </div>

    <!-- Champ: Cat√©gorie -->
    <div class="form-group">
      <label for="category">Cat√©gorie *</label>
      <select
        id="category"
        formControlName="category"
        class="form-input"
        [class.error]="submitted && category?.invalid"
      >
        <option value="">-- S√©lectionner --</option>
        <option *ngFor="let cat of categories" [value]="cat">
          {{ cat | titlecase }}
        </option>
      </select>
      <div *ngIf="submitted && category?.invalid" class="error-message">
        <span *ngIf="category?.errors?.['required']">La cat√©gorie est obligatoire</span>
      </div>
    </div>

    <!-- Champ: Fichier Audio (optionnel pour mise √† jour) -->
    <div class="form-group">
      <label for="audioFile">Fichier audio <small>(optionnel - laisser vide pour conserver l'actuel)</small></label>
      <div class="file-info">
        <small>Formats accept√©s: {{ ALLOWED_FORMATS }} | Taille max: {{ MAX_FILE_SIZE_MB }} MB</small>
      </div>
      
      <!-- Info fichier actuel -->
      <div *ngIf="currentAudioInfo && !fileInfo" class="current-file-info">
        üìÅ {{ currentAudioInfo }}
      </div>
      
      <div class="file-input-wrapper">
        <input
          id="audioFile"
          type="file"
          accept=".mp3,.wav,.ogg,audio/mpeg,audio/wav,audio/ogg"
          (change)="onFileSelected($event)"
          class="file-input"
        />
        <label for="audioFile" class="file-input-label">
          üìÅ Changer le fichier audio
        </label>
      </div>
      
      <div *ngIf="fileInfo" class="file-selected">
        ‚úÖ {{ fileInfo }}
      </div>
      
      <div *ngIf="fileError" class="error-message">
        {{ fileError }}
      </div>
    </div>

    <!-- Champ: Image de couverture (optionnel) -->
    <div class="form-group">
      <label for="coverImage">Image de couverture <small>(optionnel)</small></label>
      <div class="file-info">
        <small>Formats accept√©s: {{ ALLOWED_IMAGE_FORMATS }} | Taille max: {{ MAX_IMAGE_SIZE_MB }} MB</small>
      </div>
      
      <div class="file-input-wrapper">
        <input
          id="coverImage"
          type="file"
          accept=".png,.jpeg,.jpg,image/png,image/jpeg"
          (change)="onCoverImageSelected($event)"
          class="file-input"
        />
        <label for="coverImage" class="file-input-label">
          üñºÔ∏è {{ coverImagePreview ? 'Changer l\'image' : 'Ajouter une image' }}
        </label>
      </div>
      
      <!-- Aper√ßu de l'image -->
      <div *ngIf="coverImagePreview" class="cover-preview">
        <img [src]="coverImagePreview" alt="Aper√ßu de la couverture" class="cover-preview-img" />
        <div class="cover-preview-info">
          <span *ngIf="hasExistingCover">Image actuelle</span>
          <span *ngIf="coverImageInfo">{{ coverImageInfo }}</span>
          <button type="button" (click)="removeCoverImage()" class="btn-remove-cover">‚úï Supprimer</button>
        </div>
      </div>
      
      <div *ngIf="coverImageError" class="error-message">
        {{ coverImageError }}
      </div>
    </div>

    <!-- Boutons d'action -->
    <div class="form-actions">
      <button 
        type="submit" 
        class="btn btn-primary"
        [disabled]="isLoading"
      >
        <span *ngIf="!isLoading">üíæ Enregistrer</span>
        <span *ngIf="isLoading">‚è≥ Enregistrement...</span>
      </button>
      <button 
        type="button" 
        (click)="goBack()" 
        class="btn btn-secondary"
        [disabled]="isLoading"
      >
        Annuler
      </button>
    </div>
  </form>
</div>
